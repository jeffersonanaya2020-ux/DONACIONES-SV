<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DONACIONES</title>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
<style>
body { background-color: #ff4c4c; font-family: Arial; display: flex; justify-content: center; align-items: center; height:100vh; margin:0; position:relative;}
.container { background-color: white; border-radius:15px; padding:20px; display:flex; max-width:700px; width:90%; box-shadow:0 4px 15px rgba(0,0,0,0.3);}
.left, .right { flex:1; display:flex; flex-direction:column; align-items:center;}
.left { padding-right:20px; border-right:1px solid #ccc;}
h2 { color:#ff4c4c; }
label { display:block; margin-top:8px;}
input, select, button { width:80%; padding:10px; margin-top:8px; border-radius:8px; border:1px solid #ddd; font-size:15px;}
button { background:#ff4c4c; color:white; border:none; cursor:pointer; font-weight:700;}
#qrcode { background:#fff; padding:20px; border-radius:12px; margin-top:20px;}
#address { word-break:break-all; margin-top:10px; font-weight:bold; color:#333; text-align:center;}
#pagoExitoBtn { margin-top:15px; padding:10px 20px; font-weight:bold; background-color:#28a745; border:none; border-radius:8px; color:white; cursor:pointer; display:none; }
#pagoRecibido { font-size:24px; color:green; font-weight:bold; margin-top:30px; text-align:center; display:none; }
#usdValue { margin-top:6px; color:#555; font-size:14px; }
#qrInfo { font-size:12px; color:#555; margin-top:6px; text-align:center; display:none; }
#timer { margin-top:8px; font-size:14px; color:#ff0000; font-weight:bold; }
#watermark { position:absolute; bottom:10px; right:10px; color:rgba(0,0,0,0.2); font-size:20px; font-weight:bold; pointer-events:none; user-select:none; }
</style>
</head>
<body>

<div class="container">
  <div class="left">
    <h2>DONACIONES</h2>

    <label for="crypto">Selecciona la criptomoneda:</label>
    <select id="crypto">
      <option value="BTC">BTC</option>
      <option value="USDT_ERC20">USDT (ETH)</option>
      <option value="USDT_BSC">USDT (BSC)</option>
      <option value="USDT_TRON">USDT (TRON)</option>
      <option value="USDT_POLYGON">USDT (POLYGON)</option>
    </select>

    <label for="amount">Monto:</label>
    <input type="number" id="amount" placeholder="Ej: 0.001" step="any">
    <div id="usdValue"></div>

    <button onclick="generarQR()">Generar QR</button>
  </div>

  <div class="right">
    <h2>Pago</h2>
    <div id="qrcode"></div>
    <div id="qrInfo">Si no puedes escanear este QR tienes la dirección acá abajo</div>
    <div id="address"></div>
    <div id="timer"></div>
    <button id="pagoExitoBtn" onclick="pagoExitoso()">Pago realizado con éxito</button>
    <div id="pagoRecibido">✅ Pago recibido</div>
  </div>
</div>

<div id="watermark">Jefferson XD</div>

<script>
const addresses = {
  BTC: "bc1qk7fl896wsv4clyj5nlxfqnqpkjmeyzfly5lqsq",
  USDT_ERC20: "0x2327c9aF14B2a00897bCf5DEf5eA3b1b401Fd3C6",
  USDT_BSC: "0x2327c9aF14B2a00897bCf5DEf5eA3b1b401Fd3C6",
  USDT_TRON: "TCEd5H7GWXn5zxqwpX92iPe6NUq6J1M7uv",
  USDT_POLYGON: "0x2327c9aF14B2a00897bCf5DEf5eA3b1b401Fd3C6"
};

let btcPriceUsd = null;
let countdownInterval = null;

async function fetchBtcPrice() {
  try {
    const resp = await fetch("https://api.coingecko.com/api/v3/simple/price?ids=bitcoin&vs_currencies=usd");
    const data = await resp.json();
    btcPriceUsd = data.bitcoin.usd;
  } catch(e) { console.error("Error al obtener precio de BTC:", e); }
}
fetchBtcPrice();

document.getElementById("amount").addEventListener("input", () => {
  const crypto = document.getElementById("crypto").value;
  const amount = parseFloat(document.getElementById("amount").value);
  if(crypto === "BTC" && btcPriceUsd !== null && amount > 0) {
    const usdVal = amount * btcPriceUsd;
    document.getElementById("usdValue").innerText = "≈ USD " + usdVal.toFixed(2);
  } else { document.getElementById("usdValue").innerText = ""; }
});

document.getElementById("crypto").addEventListener("change", () => { document.getElementById("usdValue").innerText = ""; });

function generarQR() {
  const crypto = document.getElementById("crypto").value;
  const amount = document.getElementById("amount").value;
  const address = addresses[crypto];

  if(!amount || Number(amount) <= 0){ alert("Ingresa un monto válido"); return; }

  let uri = "";
  if(crypto === "BTC") uri = `bitcoin:${address}?amount=${amount}`;
  else if(crypto.includes("USDT")) uri = `${address}?amount=${amount}`;

  document.getElementById("qrcode").innerHTML = "";
  QRCode.toCanvas(uri, { width: 250 }, function(error, canvas) {
    if(error) console.error(error);
    document.getElementById("qrcode").appendChild(canvas);
  });

  document.getElementById("address").innerText = address;
  document.getElementById("pagoExitoBtn").style.display = "block";
  document.getElementById("pagoRecibido").style.display = "none";

  document.getElementById("qrInfo").style.display = "block"; // mostrar el texto
  startTimer(15 * 60); // 15 minutos
}

function startTimer(seconds) {
  clearInterval(countdownInterval);
  let remaining = seconds;
  updateTimerDisplay(remaining);

  countdownInterval = setInterval(() => {
    remaining--;
    updateTimerDisplay(remaining);
    if(remaining <= 0){
      clearInterval(countdownInterval);
      document.getElementById("qrcode").innerHTML = "";
      document.getElementById("address").innerText = "";
      document.getElementById("pagoExitoBtn").style.display = "none";
      document.getElementById("timer").innerText = "";
      document.getElementById("qrInfo").style.display = "none"; // ocultar texto
    }
  }, 1000);
}

function updateTimerDisplay(seconds) {
  const min = Math.floor(seconds / 60);
  const sec = seconds % 60;
  document.getElementById("timer").innerText = `Tiempo restante: ${min.toString().padStart(2,'0')}:${sec.toString().padStart(2,'0')}`;
}

function pagoExitoso() {
  clearInterval(countdownInterval);
  document.getElementById("qrcode").style.display = "none";
  document.getElementById("address").style.display = "none";
  document.getElementById("pagoExitoBtn").style.display = "none";
  document.getElementById("timer").innerText = "";
  document.getElementById("qrInfo").style.display = "none"; // ocultar texto
  document.getElementById("pagoRecibido").style.display = "block";
}
</script>

</body>

</html>
